# סיכום מערך הרשאות - SafeQ Cloud Manager

## 🎯 עקרונות בסיסיים

המערכת עובדת בשלושה שלבי אבטחה:
1. **אימות זהות** דרך Microsoft Entra ID (Azure AD)
2. **בדיקת הרשאות** לפי קבוצות ב-Entra ID
3. **אימות קיום משתמש** במערכת SafeQ Cloud

---

## 📊 4 רמות הרשאה

**💡 הערה:** שמות הקבוצות ניתנים להתאמה אישית דרך secrets/environment variables. ברירת המחדל:

### 🔵 SafeQ-View (צופה)
- רק צפייה
- לא יכול לשנות כלום
- רואה רק את המחלקות שלו

### 🟢 SafeQ-Support (תמיכה)
- יכול לערוך משתמשים קיימים
- יכול ליצור משתמשים חדשים
- יכול להוסיף/להסיר משתמשים מקבוצות
- לא יכול למחוק משתמשים
- רואה רק את המחלקות שלו

### 🟡 SafeQ-Admin (מנהל)
- כל מה ש-Support יכול
- **+ יכול למחוק משתמשים**
- **+ יכול לעשות פעולות קבוצתיות (Bulk)**
- רואה רק את המחלקות שלו

### 🔴 SafeQ-SuperAdmin (מנהל על)
- **גישה מלאה לכל המערכת**
- **רואה את כל המחלקות**
- אין לו הגבלות

---

## ✅ מה נדרש כדי להתחבר?

משתמש יכול להתחבר **רק אם**:

### 1️⃣ שייך לקבוצה ב-Entra ID
חייב להיות באחת מהקבוצות:
- `SafeQ-View`
- `SafeQ-Support`
- `SafeQ-Admin`
- `SafeQ-SuperAdmin`

### 2️⃣ קיים משתמש תואם ב-SafeQ Cloud
במערכת SafeQ Cloud חייב להיות משתמש עם **אותו שם משתמש**.

**דוגמה:**
- Entra ID: `cohen_m@example.com`
- SafeQ: `cohen_m@example.com` ✅

### 3️⃣ משויך למחלקה (לא חובה ל-SuperAdmin)
משתמשים רגילים חייבים להיות שייכים לקבוצת מחלקה בפורמט:
- `צפת - 240234`
- `עלי זהב - 234768`

**SuperAdmin לא צריך** - יש לו גישה לכל המחלקות אוטומטית.

---

## ❌ למה משתמש לא מצליח להתחבר?

### שגיאה 1: "גישה נדחתה. נדרשת שייכות לקבוצת SafeQ"
**בעיה:** המשתמש לא שייך לאף קבוצת SafeQ ב-Entra ID
**פתרון:** הוסף אותו לאחת מ-4 הקבוצות

### שגיאה 2: "לא נמצא משתמש לוקאלי תואם במערכת SafeQ"
**בעיה:** המשתמש לא קיים במערכת SafeQ Cloud
**פתרון:** צור משתמש ב-SafeQ Cloud עם אותו שם משתמש

### שגיאה 3: "לא נמצאו הרשאות מחלקה עבור משתמש זה"
**בעיה:** המשתמש לא משויך לאף קבוצת מחלקה
**פתרון:** שייך אותו לקבוצת מחלקה ב-SafeQ Cloud

---

## 🚀 איך מוסיפים משתמש חדש?

### צ'קליסט מהיר:
- [ ] יצירת משתמש ב-Microsoft Entra ID
- [ ] הוספה לקבוצת SafeQ מתאימה (View/Support/Admin/SuperAdmin)
- [ ] יצירת משתמש תואם ב-SafeQ Cloud
- [ ] שיוך לקבוצת מחלקה ב-SafeQ (אם לא SuperAdmin)
- [ ] בדיקת התחברות

---

## 📋 טבלת השוואה מהירה

| מה המשתמש יכול לעשות?                   | View | Support | Admin | SuperAdmin |
|------------------------------------------|------|---------|-------|------------|
| צפייה במשתמשים                            | ✅   | ✅      | ✅    | ✅         |
| צפייה בקבוצות                             | ✅   | ✅      | ✅    | ✅         |
| עריכת משתמשים קיימים                      | ❌   | ✅      | ✅    | ✅         |
| יצירת משתמשים חדשים                       | ❌   | ✅      | ✅    | ✅         |
| הוספה/הסרה מקבוצות                        | ❌   | ✅      | ✅    | ✅         |
| מחיקת משתמשים                             | ❌   | ❌      | ✅    | ✅         |
| פעולות Bulk (קבוצתיות)                   | ❌   | ❌      | ✅    | ✅         |
| גישה לכל המחלקות                          | ❌   | ❌      | ❌    | ✅         |
| גישה ל-"Local Users"                     | ❌   | ❌      | ❌    | ✅         |

---

## 💡 טיפים חשובים

1. **סדר עדיפות:** אם משתמש בכמה קבוצות, המערכת תבחר את הגבוהה ביותר:
   - SuperAdmin > Admin > Support > View

2. **אבטחה:** כל פעולה נרשמת ב-Audit Log

3. **שמות משתמש:** חייבים להיות **זהים** ב-Entra וב-SafeQ

4. **שינוי הרשאות:** פשוט מעבירים את המשתמש לקבוצה אחרת ב-Entra ID

---

## 📞 שאלות?

אם משהו לא ברור או יש בעיה - צור קשר עם צוות ה-IT.

כל פעולות הכניסה נרשמות במערכת, אז קל לאתר בעיות!

---

**עודכן:** 2025-10-30
